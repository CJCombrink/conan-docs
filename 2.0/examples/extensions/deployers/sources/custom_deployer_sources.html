



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Copy sources from all your dependencies &mdash; conan 2.0.3 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/conan-favicon.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  


  
    <link rel="stylesheet" href="../../../../_static/css/signup.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../../../_static/css/search.css" type="text/css" />
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="conan 2.0.3 documentation" href="../../../../index.html"/>
        <link rel="up" title="Custom deployers" href="../custom_deployers.html"/>
        <link rel="next" title="Conan recipe tools examples" href="../../../tools.html"/>
        <link rel="prev" title="Custom deployers" href="../custom_deployers.html"/>

 <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WK44ZFM');</script>
<!-- End Google Tag Manager -->
 



</script>


  

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html">
          

          
            
            <img src="../../../../_static/conan-docs-logo-2.svg" class="logo" />
          
          </a>

            

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../whatsnew.html">What’s new in Conan 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../conanfile.html">ConanFile methods examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../extensions.html">Conan extensions examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../commands/custom_commands.html">Custom commands</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../custom_deployers.html">Custom deployers</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Copy sources from all your dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html">Conan recipe tools examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cross_build.html">Cross-building examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config_files.html">Configuration files examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../knowledge.html">Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
</ul>

            
          
          <div class="dark_newsletter-div">
             <p><a href="https://conan.io/#signUp" target="_blank">Sign up for release updates</a></p>
          </div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">conan</a>
        
      </nav>


      
      <script>
        var reldir = "../../../../index.html".replace("index.html","").replace("#", "");
      </script>
      <div class="wy-nav-content">
        <div class="rst-content">
                 
          















<div role="navigation" aria-label="breadcrumbs navigation" id="breadcrumbs">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../examples.html">Examples</a> &raquo;</li>
        
          <li><a href="../../../extensions.html">Conan extensions examples</a> &raquo;</li>
        
          <li><a href="../custom_deployers.html">Custom deployers</a> &raquo;</li>
        
      <li>Copy sources from all your dependencies</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/conan-io/docs/blob/develop2/examples/extensions/deployers/sources/custom_deployer_sources.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
          <!--<select id="search" name="state" multiple="true" onchange="window.location = reldir + this.value;" style="width:90%"></select>
          <hr/>-->
          <!--<div class="admonition important">
            <p class="admonition-title">Announcement</p>
            <p>Recipe Hacking no. 2! Building on what we learnt during the first installment we will be working on more Conan 2.0 Migration! We'll start by reviewing some open pull requests and hopefully tackle a CMake example. <a
            href=https://jfrog.zoom.us/webinar/register/WN_grFhqH0yRBeIfJmBvQoPJw> Register here to attend.</a></p>
          </div>-->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="copy-sources-from-all-your-dependencies">
<h1>Copy sources from all your dependencies<a class="headerlink" href="#copy-sources-from-all-your-dependencies" title="Permalink to this headline">¶</a></h1>
<p>Please, first of all, clone the sources to recreate this project. You can find them in the
<a class="reference external" href="https://github.com/conan-io/examples2">examples2.0 repository</a> in GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/conan-io/examples2.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>examples2/examples/extensions/deployers/sources
</pre></div>
</div>
<p>In this example we are going to see how to create and use a custom deployer.
This deployer copies all the source files from your dependencies and puts them into a specific output folder</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To better understand this example, it is highly recommended to have previously read the <a class="reference internal" href="../../../../reference/extensions/deployers.html#reference-extensions-deployer-direct-deploy"><span class="std std-ref">Deployers</span></a> reference.</p>
</div>
<div class="section" id="locate-the-deployer">
<h2>Locate the deployer<a class="headerlink" href="#locate-the-deployer" title="Permalink to this headline">¶</a></h2>
<p>In this case, the deployer is located in the same directory as our example conanfile,
but as shown in <a class="reference internal" href="../../../../reference/extensions/deployers.html#reference-extensions-deployer-direct-deploy"><span class="std std-ref">Deployers</span></a> reference,
Conan will look for the specified deployer in a few extra places in order, namely:</p>
<ol class="arabic simple">
<li>Absolute paths</li>
<li>Relative to cwd</li>
<li>In the <code class="docutils literal notranslate"><span class="pre">[CONAN_HOME]/extensions/deploy</span></code> folder</li>
<li>Built-in deployers</li>
</ol>
</div>
<div class="section" id="run-it">
<h2>Run it<a class="headerlink" href="#run-it" title="Permalink to this headline">¶</a></h2>
<p>For our example, we have a simple recipe that lists both <code class="docutils literal notranslate"><span class="pre">zlib</span></code> and <code class="docutils literal notranslate"><span class="pre">mcap</span></code> as requirements.
With the help of the <code class="docutils literal notranslate"><span class="pre">tools.build:download_source=True</span></code> conf, we can force the invocation of its <code class="docutils literal notranslate"><span class="pre">source()</span></code> method,
which will ensure that sources are available even if no build needs to be carried out.</p>
<p>Now, you should be able to use the new deployer in both <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">install</span></code> and <code class="docutils literal notranslate"><span class="pre">conan</span> <span class="pre">graph</span></code> commands for any given recipe:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conan<span class="w"> </span>graph<span class="w"> </span>info<span class="w"> </span>.<span class="w"> </span>-c<span class="w"> </span>tools.build:download_source<span class="o">=</span>True<span class="w"> </span>--deploy<span class="o">=</span>sources_deploy
</pre></div>
</div>
<p>Inspecting the command output we can see that it copied the sources of our direct dependencies <code class="docutils literal notranslate"><span class="pre">zlib</span></code> and <code class="docutils literal notranslate"><span class="pre">mcap</span></code>,
<strong>plus</strong> the sources of our transitive dependencies, <code class="docutils literal notranslate"><span class="pre">zstd</span></code> and <code class="docutils literal notranslate"><span class="pre">lz4</span></code> to a <code class="docutils literal notranslate"><span class="pre">dependencies_sources</span></code> folder.
After this is done, extra preprocessing could be done to accomplish more specific needs.</p>
</div>
<div class="section" id="code-tour">
<h2>Code tour<a class="headerlink" href="#code-tour" title="Permalink to this headline">¶</a></h2>
<p>The <strong>source_deploy.py</strong> file has the following code:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><strong>sources_deploy.py</strong></span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">conan.tools.files</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Note the kwargs argument is mandatory to be robust against future changes.</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">conanfile</span><span class="o">.</span><span class="n">dependencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">dep</span><span class="o">.</span><span class="n">folders</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dep</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">source_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConanException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sources missing for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> dependency.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                  <span class="s2">&quot;This deployer needs the sources of every dependency present to work, either building from source, &quot;</span>
                                  <span class="s2">&quot;or by using the &#39;tools.build:download_source&#39; conf.&quot;</span><span class="p">)</span>
        <span class="n">copy</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">conanfile</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">dep</span><span class="o">.</span><span class="n">folders</span><span class="o">.</span><span class="n">source_folder</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;dependency_sources&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">dep</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="deploy">
<h3>deploy()<a class="headerlink" href="#deploy" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">deploy()</span></code> method is called by Conan, and gets both a dependency graph and an output folder path as arguments.
It iterates all the dependencies of our recipe and copies every source file to their respective folders
under <code class="docutils literal notranslate"><span class="pre">dependencies_sources</span></code> using <a class="reference internal" href="../../../../reference/tools/files/basic.html#conan-tools-files-copy"><span class="std std-ref">conan.tools.copy</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you’re using this deployer as an example for your own, remember that
<code class="docutils literal notranslate"><span class="pre">tools.build:download_source=True</span></code> is necessary so that <code class="docutils literal notranslate"><span class="pre">dep.folders.source_folder</span></code> is defined for the dependencies.
Without the conf, said variable will not be defined for those dependencies that do not need to be built from sources
nor in those commands that do not require building, such as <strong class="command">conan graph</strong>.</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../../tools.html" class="btn btn-neutral float-right" title="Conan recipe tools examples" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../custom_deployers.html" class="btn btn-neutral" title="Custom deployers" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2023, JFrog.
      Last updated on Apr 03, 2023.
      <span><a href="#" class="ot-sdk-show-settings">Cookies Settings</a></span>
    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <!--<span class="fa fa-pencil-square-o"> Other versions:</span> -->
      Version: 2.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
            
                <dd><a href="/2.0/index.html">2.0</a></dd>
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
                   
        
            
                <dd><a href="/2/index.html">2</a></dd>
                   
        
        <br>
        
                   
        
            
                <dd><a href="/1/index.html">1</a></dd>
                   
        
            
                <dd><a href="/en/1.59/index.html">1.59</a></dd>
                   
        
            
                <dd><a href="/en/1.58/index.html">1.58</a></dd>
                   
        
            
                <dd><a href="/en/1.57/index.html">1.57</a></dd>
                   
        
            
                <dd><a href="/en/1.56/index.html">1.56</a></dd>
                   
        
            
                <dd><a href="/en/1.55/index.html">1.55</a></dd>
                   
        
            
                <dd><a href="/en/1.54/index.html">1.54</a></dd>
                   
        
            
                <dd><a href="/en/1.53/index.html">1.53</a></dd>
                   
        
            
                <dd><a href="/en/1.52/index.html">1.52</a></dd>
                   
        
            
                <dd><a href="/en/1.51/index.html">1.51</a></dd>
                   
        
            
                <dd><a href="/en/1.50/index.html">1.50</a></dd>
                   
        
            
                <dd><a href="/en/1.49/index.html">1.49</a></dd>
                   
        
            
                <dd><a href="/en/1.48/index.html">1.48</a></dd>
                   
        
            
                <dd><a href="/en/1.47/index.html">1.47</a></dd>
                   
        
            
                <dd><a href="/en/1.46/index.html">1.46</a></dd>
                   
        
            
                <dd><a href="/en/1.45/index.html">1.45</a></dd>
                   
        
            
                <dd><a href="/en/1.44/index.html">1.44</a></dd>
                   
        
            
                <dd><a href="/en/1.43/index.html">1.43</a></dd>
                   
        
            
                <dd><a href="/en/1.42/index.html">1.42</a></dd>
                   
        
            
                <dd><a href="/en/1.41/index.html">1.41</a></dd>
                   
        
            
                <dd><a href="/en/1.40/index.html">1.40</a></dd>
                   
        
            
                <dd><a href="/en/1.39/index.html">1.39</a></dd>
                   
        
            
                <dd><a href="/en/1.38/index.html">1.38</a></dd>
                   
        
            
                <dd><a href="/en/1.37/index.html">1.37</a></dd>
                   
        
            
                <dd><a href="/en/1.36/index.html">1.36</a></dd>
                   
        
            
                <dd><a href="/en/1.35/index.html">1.35</a></dd>
                   
        
            
                <dd><a href="/en/1.34/index.html">1.34</a></dd>
                   
        
            
                <dd><a href="/en/1.33/index.html">1.33</a></dd>
                   
        
            
                <dd><a href="/en/1.32/index.html">1.32</a></dd>
                   
        
            
                <dd><a href="/en/1.31/index.html">1.31</a></dd>
                   
        
            
                <dd><a href="/en/1.30/index.html">1.30</a></dd>
                   
        
            
                <dd><a href="/en/1.29/index.html">1.29</a></dd>
                   
        
            
                <dd><a href="/en/1.28/index.html">1.28</a></dd>
                   
        
            
                <dd><a href="/en/1.27/index.html">1.27</a></dd>
                   
        
            
                <dd><a href="/en/1.26/index.html">1.26</a></dd>
                   
        
            
                <dd><a href="/en/1.25/index.html">1.25</a></dd>
                   
        
            
                <dd><a href="/en/1.24/index.html">1.24</a></dd>
                   
        
            
                <dd><a href="/en/1.23/index.html">1.23</a></dd>
                   
        
            
                <dd><a href="/en/1.22/index.html">1.22</a></dd>
                   
        
            
                <dd><a href="/en/1.21/index.html">1.21</a></dd>
                   
        
            
                <dd><a href="/en/1.20/index.html">1.20</a></dd>
                   
        
            
                <dd><a href="/en/1.19/index.html">1.19</a></dd>
                   
        
            
                <dd><a href="/en/1.18/index.html">1.18</a></dd>
                   
        
            
                <dd><a href="/en/1.17/index.html">1.17</a></dd>
                   
        
            
                <dd><a href="/en/1.16/index.html">1.16</a></dd>
                   
        
            
                <dd><a href="/en/1.15/index.html">1.15</a></dd>
                   
        
            
                <dd><a href="/en/1.14/index.html">1.14</a></dd>
                   
        
            
                <dd><a href="/en/1.13/index.html">1.13</a></dd>
                   
        
            
                <dd><a href="/en/1.12/index.html">1.12</a></dd>
                   
        
            
                <dd><a href="/en/1.11/index.html">1.11</a></dd>
                   
        
            
                <dd><a href="/en/1.10/index.html">1.10</a></dd>
                   
        
            
                <dd><a href="/en/1.9/index.html">1.9</a></dd>
                   
        
            
                <dd><a href="/en/1.8/index.html">1.8</a></dd>
                   
        
            
                <dd><a href="/en/1.7/index.html">1.7</a></dd>
                   
        
            
                <dd><a href="/en/1.6/index.html">1.6</a></dd>
                   
        
            
                <dd><a href="/en/1.5/index.html">1.5</a></dd>
                   
        
            
                <dd><a href="/en/1.4/index.html">1.4</a></dd>
                   
        
            
                <dd><a href="/en/1.3/index.html">1.3</a></dd>
                   
        
                   
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
            <dd><a href="/2.0/conan.pdf">PDF</a></dd> 
               
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'2.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  <!-- <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  <script src="../../../../_static/js/modernizr.min.js"></script>
  <script src="../../../../_static/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
-->
  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  


  <script>
    // initSearch("2.0");
  </script>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WK44ZFM" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


 


</body>
</html>